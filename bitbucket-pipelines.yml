# This is a sample build configuration for C++ â€“ Make.
# Check our guides at https://confluence.atlassian.com/x/5Q4SMw for more examples.
# Only use spaces to indent your .yml configuration.
# -----
# You can specify a custom docker image from Docker Hub as your build environment.
image: gcc:latest

pipelines:
  default:
    - step:
        script:
          - apt-get update
          - apt-get install -y cmake libgtest-dev libhdf5-dev libeigen3-dev libboost-dev libnlopt-dev

          # Build gtest (have to, since libgtest-dev only includes sources, no binaries available currently...)
          - cd /usr/src/gtest
          - cmake CMakeLists.txt
          - make
          - cp *.a /usr/lib


          # Build muq
          - cd $BITBUCKET_CLONE_DIR
          - cd build
          - cmake -DMUQ_HDF5_DIR=/usr/lib/x86_64-linux-gnu/hdf5/serial -DMUQ_USE_GTEST=ON ..
          - make
          - make install
          - ./runTests
